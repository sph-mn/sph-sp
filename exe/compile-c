#!/bin/sh

optimisation=0
target_dir=temp
kissfft=source/c/foreign/kissfft
c=source/c-precompiled
root="$PWD"
warnings="-Wunused-label -Wunused-value -Wunused-variable"
gcc_options="$warnings -Wfatal-errors -O$optimisation"

compile_sph_sp() {
  target="$target_dir/libsph-sp.so"
  source="$c/main/main.c"
  gcc -Wl,--version-script=other/shared-library-exports -shared -fpic "$source" -o "$target" \
    $gcc_options -lsndfile -lasound -lm -I"$kissfft" "$kissfft"/kiss_fft.c "$kissfft"/tools/kiss_fftr.c
}

compile_test_sph_sp() {
  export LIBRARY_PATH="$root/temp"
  gcc "$c/test/main.c" -o temp/test-libsph-sp -lsph-sp -lm $gcc_options
}

mkdir -p "$target_dir" &&
compile_sph_sp
#compile_test_sph_sp
