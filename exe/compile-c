#!/bin/sh

optimisation=3
warnings="-Wunused-label -Wunused-value -Wunused-variable"
gcc_options="-Wfatal-errors $warnings -std=c11 -O$optimisation -lguile-2.2 -lgc -lasound"
c=source/c-precompiled
dir=temp
file="$dir/libguile-sph-sp.so"
source="$c/main.c"

compile_libguile_sph_sp() {
  gcc -Wl,--version-script=other/export -shared -fpic "$source" -o "$file" \
    -Isource/c foreign/kissfft/kiss_fft.c foreign/kissfft/tools/kiss_fftr.c \
    $gcc_options
}

mkdir -p "$dir" &&
compile_libguile_sph_dg
